#!/bin/sh
# Print the current change's description (max 8 chars + ellipsis if longer)
# Returns "(empty)" if there is no description.

if ! jj workspace root --ignore-working-copy >/dev/null 2>&1; then
  exit 0
fi

# Get the first line of the description (no colors)
desc=$(jj --color=never log --ignore-working-copy --no-graph \
          -r @ -T 'description.first_line()' 2>/dev/null)

if [ -z "$desc" ]; then
  printf '(empty)\n'
else
  # Limit to 8 chars and add "…" if it's longer
  if [ ${#desc} -gt 8 ]; then
    printf '%s…\n' "${desc%"${desc#????????}"}"
  else
    printf '%s\n' "$desc"
  fi
fi
